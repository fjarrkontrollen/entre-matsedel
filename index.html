<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Matsedel</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    background: transparent;
    font-family: 'Inter', sans-serif;
    display: flex;
    align-items: center;
    height: 100vh;
    padding-left: 80px;
    opacity: 0;
    transition: opacity 1.5s ease;
  }

  .container {
    width: 900px;
  }

  .date {
    font-size: 36px;
    font-weight: 500;
    color: #D1D5DB;
    margin-bottom: 20px;
  }

  .title {
    font-size: 32px;
    font-weight: 500;
    color: #D1D5DB;
    margin-bottom: 25px;
  }

  .meals-wrapper {
    height: 400px;   /* JUSTERA ENDAST DENNA */
    overflow: hidden;
  }

  .meal {
    font-size: 48px;
    font-weight: 500;
    color: #E5E7EB;
    line-height: 1.2;
    margin-bottom: 15px;
    word-break: break-word;
  }

</style>
</head>

<body>

<div id="output">Laddar...</div>

<script>

var csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTv0TPMhZnKEg0SkHfRx7-s8XiITehnj6o_fYQm4YqNY1zxvmnEElzleBI_Q3eAG-mt8AyIdk3Qiwc6/pub?output=csv";

function formatDateSwedish(date) {
  var weekdays = ["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"];
  var months = ["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"];
  return weekdays[date.getDay()] + " " + date.getDate() + " " + months[date.getMonth()];
}

function loadCSV() {
  var xhr = new XMLHttpRequest();
  xhr.open("GET", csvUrl, true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      parseCSV(xhr.responseText);
    }
  };
  xhr.send();
}


function parseCSV(data) {

  var rows = data.trim().split("\n");
  var today = new Date().toISOString().split("T")[0];

  for (var i = 1; i < rows.length; i++) {

    var cols = rows[i].split(",");

    if (!cols || cols.length < 3) continue;

    var rowDate = cols[0].trim();
    var mainMeal = cols[1].trim();
    var altMeal = cols[2].trim();

    if (rowDate === today) {

      document.getElementById("output").innerHTML =
        "<div class='container'>" +
        "<div class='date'>" + formatDateSwedish(new Date()) + "</div>" +
        "<div class='title'>Matsedel:</div>" +
        "<div class='meals-wrapper'>" +
        "<div class='meal'>" + mainMeal + "</div>" +
        "<div class='meal'>" + altMeal + "</div>" +
        "</div>" +
        "</div>";

      setTimeout(autoResizeText, 50);
      fadeIn();
      return;
    }
  }
}

  

function autoResizeText() {

  var wrapper = document.querySelector('.meals-wrapper');
  var meals = document.querySelectorAll('.meal');

  var fontSize = 48;
  var minFontSize = 16;

  while (wrapper.scrollHeight > wrapper.clientHeight && fontSize > minFontSize) {

    fontSize -= 1;

    for (var i = 0; i < meals.length; i++) {
      meals[i].style.fontSize = fontSize + "px";
    }
  }
}

function fadeIn() {
  setTimeout(function() {
    document.body.style.opacity = 1;
  }, 12000);
}

loadCSV();

</script>

</body>
</html>
